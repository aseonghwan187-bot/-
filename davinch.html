<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‹¤ë¹ˆì¹˜ ì½”ë“œ (Davinci Code)</title>
    <style>
        :root { --bg: #0f0f0f; --accent: #00d2ff; --black: #1a1a1a; --white: #ffffff; --joker: #f1c40f; }
        body { background: var(--bg); color: white; font-family: 'Pretendard', sans-serif; text-align: center; margin: 0; overflow: hidden; }
        .screen { display: none; padding: 20px; height: 100vh; box-sizing: border-box; }
        .active { display: block; }
        
        #big-notice {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.5);
            font-size: 55px; font-weight: 900; z-index: 1000; pointer-events: none; opacity: 0; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 90%; line-height: 1.3; text-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        #big-notice.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }

        .how-to { background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 15px; margin: 10px auto; max-width: 500px; text-align: left; font-size: 13px; color: #ccc; }
        .menu-box { background: #222; padding: 15px; margin: 10px auto; max-width: 500px; cursor: pointer; border-radius: 12px; border: 1px solid #444; transition: 0.2s; }
        .menu-box:hover { border-color: var(--accent); background: #2a2a2a; }

        .hand { display: flex; justify-content: center; gap: 8px; min-height: 100px; flex-wrap: wrap; align-items: center; }
        .card { 
            width: 55px; height: 82px; border-radius: 8px; display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-size: 26px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }
        .black { background: var(--black); color: white; border: 2px solid #444; }
        .white { background: var(--white); color: #1a1a1a; border: 2px solid #ddd; }
        .joker { border: 3px dashed var(--joker) !important; }
        .hidden { color: transparent !important; }
        .revealed { outline: 4px solid #ff4757; transform: translateY(-5px); box-shadow: 0 0 15px rgba(255,71,87,0.5); }

        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 950px; margin: 0 auto; }
        .player-box { background: #1e1e1e; padding: 15px; border-radius: 15px; border: 2px solid #333; }
        .active-turn { border-color: var(--joker); background: #252525; }
        
        .deck-btn { width: 110px; height: 130px; border-radius: 12px; cursor: pointer; border: 3px solid #444; font-weight: bold; background: #333; color: #fff; }
        .deck-btn:disabled { opacity: 0.3; }
        .deck-count { font-size: 28px; display: block; margin-top: 10px; }
        .joker-arrow { color: var(--joker); cursor: pointer; font-size: 35px; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-8px); } }
    </style>
</head>
<body>

<div id="big-notice">READY</div>

<div id="screen-main" class="screen active">
    <h1>ğŸ§© ë‹¤ë¹ˆì¹˜ ì½”ë“œ (Davinci Code)</h1>
    <div class="how-to">
        <h4>ğŸ“– ê²Œì„ ë°©ë²•</h4>
        <ul>
            <li>ìˆ«ìëŠ” <b>0~11</b> ìˆœì„œë¡œ ìë™ ì •ë ¬ë©ë‹ˆë‹¤.</li>
            <li>ìƒëŒ€ ì¹´ë“œë¥¼ í´ë¦­í•´ ìˆ«ìë¥¼ ë§ì¶”ì„¸ìš”. í‹€ë¦¬ë©´ ë‚´ íŒ¨ê°€ ê³µê°œë©ë‹ˆë‹¤.</li>
            <li>ì¤‘ì•™ ë±ì´ ë¹„ë©´ ë½‘ê¸° ì—†ì´ ë°”ë¡œ ê³µê²© ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</li>
        </ul>
        <span style="color:#ff4757; font-weight:bold;">â€» ì‹¤ì œ ë³´ë“œê²Œì„ê³¼ ë‹¬ë¦¬ ì¶”ê°€ ê³µê²© ì—†ì´ í„´ì´ êµì²´ë©ë‹ˆë‹¤.</span>
    </div>
    <div class="menu-box" onclick="showScreen('screen-diff')"><h3>1:1 ëª¨ë“œ ì‹œì‘</h3><p>ì§€ëŠ¥ì ì¸ AIì™€ ë‹¨ë‘˜ì´ ìŠ¹ë¶€í•©ë‹ˆë‹¤.</p></div>
    <div class="menu-box" onclick="startGame(3, 1)"><h3>ì„œë°”ì´ë²Œ ëª¨ë“œ (4ì¸)</h3><p>AI 3ëª…ê³¼ í•¨ê»˜í•˜ëŠ” 2x2 ìƒì¡´ ê²Œì„</p></div>
</div>

<div id="screen-diff" class="screen">
    <h2>ë‚œì´ë„ ì¡°ì •</h2>
    <div class="menu-box" onclick="startGame(1, 0)"><h3>ì‰¬ì›€ (ì…ë¬¸)</h3><p>AIê°€ ê±°ì˜ ë¬´ì‘ìœ„ë¡œ ì¶”ì¸¡í•©ë‹ˆë‹¤. (ëª…ì¤‘ë¥  15%)</p></div>
    <div class="menu-box" onclick="startGame(1, 1)"><h3>ë³´í†µ (ìˆ™ë ¨)</h3><p>ë…¼ë¦¬ì ì¸ ë²”ìœ„ë¥¼ ê³„ì‚°í•˜ì—¬ ì¶”ì¸¡í•©ë‹ˆë‹¤. (ëª…ì¤‘ë¥  35%)</p></div>
    <div class="menu-box" onclick="startGame(1, 2)"><h3>ì–´ë ¤ì›€ (ì „ë¬¸ê°€)</h3><p>ë§¤ìš° ì˜ˆë¦¬í•˜ê²Œ ë‹¹ì‹ ì˜ íŒ¨ë¥¼ ì½ìŠµë‹ˆë‹¤. (ëª…ì¤‘ë¥  60%)</p></div>
    <div class="menu-box" onclick="startGame(1, 3)" style="border-color:#ff4757"><h3>í•´íƒˆ (ì‹ ì˜ ì˜ì—­)</h3><p>ëª¨ë“  ìƒí™©ì„ ì™„ë²½í•˜ê²Œ ê³„ì‚°í•©ë‹ˆë‹¤. (ëª…ì¤‘ë¥  85%)</p></div>
</div>

<div id="screen-init" class="screen">
    <h2>ì‹œì‘ ì¹´ë“œ 4ì¥ ì„ íƒ</h2>
    <div style="display:flex; justify-content:center; gap:30px;">
        <button class="deck-btn black" onclick="pick('black')">BLACK<span class="deck-count" id="ic-b">13</span></button>
        <button class="deck-btn white" onclick="pick('white')">WHITE<span class="deck-count" id="ic-w">13</span></button>
    </div>
    <div id="my-init-hand" class="hand" style="margin-top:30px;"></div>
    <div id="joker-ui" style="display:none; margin-top:20px;"><div id="pos-selector" class="hand"></div></div>
</div>

<div id="screen-game" class="screen">
    <div id="board-grid" class="grid-container"></div>
    <div id="draw-zone" style="display:none; margin-top:50px;">
        <div style="display:flex; justify-content:center; gap:30px;">
            <button class="deck-btn black" id="btn-draw-b" onclick="draw('black')">BLACK<span id="gc-b" class="deck-count"></span></button>
            <button class="deck-btn white" id="btn-draw-w" onclick="draw('white')">WHITE<span id="gc-w" class="deck-count"></span></button>
        </div>
    </div>
</div>

<script>
    let players = [], turn = 0, deck = {black:[], white:[]}, picked = [], bCnt=1, diff=1, state="START", tempJoker=null;

    function notify(text, color = "#00d2ff") {
        const el = document.getElementById('big-notice');
        el.innerText = text; el.style.color = color; el.classList.add('show');
        setTimeout(() => el.classList.remove('show'), 1500);
    }

    function showScreen(id) { document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }

    function startGame(bc, d) {
        bCnt = bc; diff = d;
        deck.black = [...Array(12).keys(), '-']; deck.white = [...Array(12).keys(), '-'];
        picked = []; showScreen('screen-init'); updateCnt();
    }

    function pick(c) {
        if(picked.length>=4 || tempJoker) return;
        let n = deck[c].splice(Math.floor(Math.random()*deck[c].length), 1)[0];
        if(n==='-') { tempJoker={color:c, num:n, rev:false}; renderPos(); }
        else { picked.push({color:c, num:n, rev:false}); sort(picked); renderInit(); if(picked.length==4) { notify("GAME START", "#f1c40f"); setTimeout(initBoard, 1600); } }
        updateCnt();
    }

    function sort(h) {
        let nums = h.filter(c=>c.num!=='-').sort((a,b)=>a.num===b.num?(a.color==='black'?-1:1):a.num-b.num);
        let nIdx = 0; for(let i=0; i<h.length; i++) if(h[i].num!=='-') h[i] = nums[nIdx++];
    }

    function renderPos() {
        notify("ì¡°ì»¤ ë°°ì¹˜!", "#f1c40f"); document.getElementById('joker-ui').style.display='block';
        const s = document.getElementById('pos-selector'); s.innerHTML='';
        for(let i=0; i<=picked.length; i++) {
            let a = document.createElement('div'); a.className='joker-arrow'; a.innerText='â†‘';
            a.onclick=()=>{ picked.splice(i,0,tempJoker); tempJoker=null; document.getElementById('joker-ui').style.display='none'; renderInit(); if(picked.length==4) { notify("GAME START", "#f1c40f"); setTimeout(initBoard, 1600); } };
            s.appendChild(a);
            if(i<picked.length) { let c=document.createElement('div'); c.className=`card ${picked[i].color}`; c.innerText=picked[i].num; s.appendChild(c); }
        }
    }

    function initBoard() {
        players = [{id:0, name:"ë‚˜ (PLAYER)", hand:picked, alive:true, bot:false}];
        for(let i=1; i<=bCnt; i++) {
            let h=[]; for(let j=0; j<4; j++) {
                let c=Math.random()>0.5?'black':'white'; let n=deck[c].splice(Math.floor(Math.random()*deck[c].length),1)[0];
                h.push({color:c, num:n, rev:false}); sort(h);
            }
            players.push({id:i, name:`AI ${i}`, hand:h, alive:true, bot:true, diff:diff});
        }
        showScreen('screen-game'); startTurn();
    }

    function startTurn() {
        render();
        let isPlayer = players[turn].id === 0;
        let deckEmpty = (deck.black.length + deck.white.length === 0);

        if (isPlayer) {
            notify("MY TURN", "#00d2ff");
            if (deckEmpty) setTimeout(() => { notify("ë‚¨ì€ ì¹´ë“œ ì—†ìŒ!\nì¦‰ì‹œ ê³µê²©", "#ff4757"); state = "GUESS"; render(); }, 1600);
            else setTimeout(() => notify("ì¹´ë“œë¥¼ í•œ ì¥ ë½‘ìœ¼ì„¸ìš”", "#fff"), 1600);
        } else {
            notify(`${players[turn].name} TURN`, "#ff4757");
            setTimeout(bot, 1800);
        }
    }

    function render() {
        const grid = document.getElementById('board-grid'); grid.innerHTML='';
        players.forEach((p, idx) => {
            let pBox = document.createElement('div'); pBox.className = `player-box ${turn === idx ? 'active-turn' : ''}`; pBox.style.opacity = p.alive ? 1 : 0.3;
            pBox.innerHTML = `<div style="color:#f1c40f; font-size:12px; margin-bottom:5px;">â—€ ì‘ì€ ìˆ«ì | í° ìˆ«ì â–¶</div><strong>${p.name}</strong>`;
            let hDiv = document.createElement('div'); hDiv.className='hand';
            p.hand.forEach(c => {
                let e = document.createElement('div');
                let isHidden = (p.id !== 0 && !c.rev);
                e.className = `card ${c.color} ${isHidden?'hidden':''} ${c.rev?'revealed':''} ${c.num==='-'?'joker':''}`;
                e.innerText = c.num; if(turn==0 && state=="GUESS" && p.id!=0 && p.alive && !c.rev) e.onclick=()=>guess(p.id, c);
                hDiv.appendChild(e);
            });
            pBox.appendChild(hDiv); grid.appendChild(pBox);
        });
        updateCnt();
        document.getElementById('draw-zone').style.display = (turn==0 && state=="START" && (deck.black.length + deck.white.length > 0)) ? 'block' : 'none';
        document.getElementById('btn-draw-b').disabled = deck.black.length === 0;
        document.getElementById('btn-draw-w').disabled = deck.white.length === 0;
    }

    function draw(c) {
        let n=deck[c].splice(Math.floor(Math.random()*deck[c].length),1)[0];
        let nc={color:c, num:n, rev:false, fresh:true};
        if(n==='-') { tempJoker=nc; state="J_POS"; renderGameJoker(); }
        else { players[0].hand.push(nc); sort(players[0].hand); state="GUESS"; notify("ê³µê²© ìƒëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”!", "#ff4757"); render(); }
    }

    function renderGameJoker() {
        notify("ì¡°ì»¤ ë°°ì¹˜!", "#f1c40f");
        const grid = document.getElementById('board-grid'); const myBox = grid.children[0]; 
        const myHand = myBox.querySelector('.hand'); myHand.innerHTML='';
        for(let i=0; i<=players[0].hand.length; i++) {
            let a=document.createElement('div'); a.className='joker-arrow'; a.innerText='â†‘';
            a.onclick=()=>{ players[0].hand.splice(i,0,tempJoker); tempJoker=null; state="GUESS"; notify("ê³µê²© ìƒëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”!", "#ff4757"); render(); };
            myHand.appendChild(a);
            if(i<players[0].hand.length) { let c=players[0].hand[i]; let e=document.createElement('div'); e.className=`card ${c.color} ${c.rev?'revealed':''}`; e.innerText=c.num; myHand.appendChild(e); }
        }
    }

    function guess(tid, c) {
        let v = prompt(`${players[tid].name}ì˜ ìˆ«ìëŠ”? (0~11 ë˜ëŠ” -)`); if(v==null) return;
        if(v == c.num) { notify(`ì •ë‹µ! (${v})`, "#2ed573"); c.rev=true; check(); setTimeout(endTurn, 1600); }
        else { notify(`ì‹¤íŒ¨! (${v} ì•„ë‹˜)`, "#ff4757"); revealMyCard(); setTimeout(endTurn, 1600); }
    }

    function revealMyCard() {
        let f=players[0].hand.find(x=>x.fresh);
        if(f) f.rev=true; 
        else { let unrev = players[0].hand.filter(x=>!x.rev); if(unrev.length) unrev[Math.floor(Math.random()*unrev.length)].rev=true; }
    }

    function bot() {
        let p=players[turn];
        if (deck.black.length + deck.white.length > 0) {
            let c=deck.black.length>=deck.white.length?'black':'white';
            let n=deck[c].splice(Math.floor(Math.random()*deck[c].length),1)[0];
            let nc={color:c, num:n, rev:false, fresh:true};
            if(n==='-') p.hand.splice(0,0,nc); else { p.hand.push(nc); sort(p.hand); }
        }
        render();
        setTimeout(() => {
            let targets = players.filter(x=>x.id!=turn && x.alive);
            let t = targets[Math.floor(Math.random()*targets.length)];
            let tc_list = t.hand.filter(x=>!x.rev);
            let tc = tc_list[Math.floor(Math.random()*tc_list.length)];
            
            let colorText = tc.color === 'black' ? 'ê²€ì •' : 'í°ìƒ‰';
            let hitChance = [0.15, 0.35, 0.60, 0.85][p.diff];
            let predictedNum = (Math.random() < hitChance) ? tc.num : Math.floor(Math.random()*12);
            
            notify(`${p.name} â†’ ${t.name}\n[${colorText} ì¹´ë“œ]ë¥¼ [${predictedNum}]ë¡œ ì˜ˆì¸¡!`, "#ff4757");

            setTimeout(() => {
                if(predictedNum == tc.num) { notify(`AI ì •ë‹µ! (${tc.num})`, "#ff4757"); tc.rev=true; check(); } 
                else { notify(`AI ì˜¤ë‹µ!`, "#2ed573"); let f=p.hand.find(x=>x.fresh); if(f) f.rev=true; }
                setTimeout(endTurn, 1800);
            }, 1800);
        }, 1600);
    }

    function endTurn() { 
        players.forEach(p=>p.hand.forEach(x=>delete x.fresh)); 
        state="START"; 
        do { turn=(turn+1)%players.length; } while(!players[turn].alive); 
        startTurn(); 
    }

    function check() { players.forEach(p=>{if(p.hand.every(x=>x.rev)) p.alive=false;}); if(players.filter(x=>x.alive).length==1) { notify("ìŠ¹ë¦¬: " + players.find(x=>x.alive).name, "#f1c40f"); setTimeout(()=>location.reload(), 3000); } }
    function updateCnt() { 
        document.getElementById('ic-b').innerText=deck.black.length; document.getElementById('ic-w').innerText=deck.white.length; 
        if(document.getElementById('gc-b')) { document.getElementById('gc-b').innerText=deck.black.length; document.getElementById('gc-w').innerText=deck.white.length; }
    }
    function renderInit() { const c = document.getElementById('my-init-hand'); c.innerHTML=''; picked.forEach(x=>{ let e=document.createElement('div'); e.className=`card ${x.color}`; e.innerText=x.num; c.appendChild(e); }); }
</script>
</body>
</html>